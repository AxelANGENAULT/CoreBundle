{# src/Arii/CoreBundle/Resources/views/Batch/list.html.twig #}
{% extends "AriiCoreBundle::layout.html.twig" %}
{% block dhtmlx %}
	<title>Ari'i</title>
	<link rel="stylesheet" type="text/css" href="{{ asset('arii/dhtmlx/dhtmlx_pro_full/dhtmlx.css') }}" />
        <script src="{{ asset('arii/dhtmlx/dhtmlx_pro_full/dhtmlx.js') }}" type="text/javascript"></script>
        <script src="{{ asset('arii/dhtmlx/dhtmlxForm/codebase/ext/dhtmlxform_item_upload.js') }}" type="text/javascript"></script> 
        <script src="{{ asset('arii/dhtmlx/dhtmlxForm/codebase/ext/swfobject.js') }}" type="text/javascript"></script> 
        <link rel="stylesheet" type="text/css" href="{{ asset('arii/dhtmlx/dhtmlxWindows/codebase/status_toolbar_layout.css') }}" />
{% endblock dhtmlx %}
{% block content %}
<!--[if !IE]>start section<![endif]-->	
<div class="section table_section">
	<!--[if !IE]>start title wrapper<![endif]-->
	<div class="title_wrapper">
		<h2>{{ "Cron converter" | trans }}</h2>
		
		<!--[if !IE]>start section menu<![endif]-->
		<!--[if !IE]>end section menu<![endif]-->
		
		
		<span class="title_wrapper_left"></span>
		<span class="title_wrapper_right"></span>
	</div>
	<!--[if !IE]>end title wrapper<![endif]-->
<!--[if !IE]>start section content<![endif]-->
	<div class="section_content">
		<!--[if !IE]>start section content top<![endif]-->
		<div class="sct">
			<div class="sct_left">
				<div class="sct_right">
					<div class="sct_left">
						<div class="sct_right">
    <div id="mygrid" style="height:556px;background-color:white;position:relative;overflow:hidden;"></div>
                                                </div>
					</div>
				</div>
			</div>
		</div>
		<!--[if !IE]>end section content top<![endif]-->
		<!--[if !IE]>start section content bottom<![endif]-->
		<span class="scb"><span class="scb_left"></span><span class="scb_right"></span></span>
		<!--[if !IE]>end section content bottom<![endif]-->
		
	</div>
	<!--[if !IE]>end section content<![endif]-->
</div>
<script>
var dhxLayout = new dhtmlXLayoutObject("mygrid","3L");

dhxLayout.cells("a").setWidth(360);
dhxTabbar = dhxLayout.cells("a").attachTabbar();
dhxTabbar.setImagePath("{{ asset("arii/dhtmlx/dhtmlxTabbar/codebase/imgs/") }}");
dhxTabbar.setSkin("dhx_skyblue");
dhxTabbar.addTab("a1", "{{ "Paste" | trans }}", 120);
dhxTabbar.cells("a1").style.backgroundColor= "#cbe2ed";
dhxTabbar.addTab("a2", "{{ "Upload" | trans }}", 120);
dhxTabbar.cells("a2").style.backgroundColor= "#cbe2ed";
dhxTabbar.setTabActive("a1");

var myForm,
formData,
myForm2,
formData2;

dhtmlx.skin = "dhx_skyblue";
formData = [{
    type: "fieldset",
    label: "{{ "Uploader" | trans }}",
    inputWidth: 350,
    inputHeight: 650,
    list: [{
        type: "upload",
        name: "myFiles",
        inputWidth: 300,
        inputHeight: 160,
        url: "{{ url('json_Home_cron_upload') }}",
        _swfLogs: "enabled",
        autoStart: true,
        swfPath: "{{ asset('arii/dhtmlx/dhtmlxForm/codebase/ext/uploader.swf') }}",
        swfUrl: "{{ url('json_Home_cron_upload') }}"
    }]
    }];
myForm = dhxTabbar.cells("a2").attachForm(formData);

myForm.setSkin("dhx_skyblue");
//myForm.setSkin("dhx_web");
/*
myForm.attachEvent("onUploadFile", function(realName, serverName) {
    dhtmlx.message({
         type: "notice",
         lifetime: 60000,
         text: "{{ "Upload" | trans }}: "+ realName + "->" + serverName });
});
*/
myForm.attachEvent("onUploadCancel", function(realName) {
    dhtmlx.message({
         type: "alert-warning",
         lifetime: 60000,
         text: "{{ "Upload canceled" | trans }} "+ realName });
});
myForm.attachEvent("onUploadFail", function(realName) {
    dhtmlx.message({
         type: "alert-error",
         lifetime: 60000,
         text: "{{ "Upload failed" | trans }} "+ realName });
});
myForm.attachEvent("onFileRemove", function(realName, serverName) {
    dhtmlx.message({
         type: "notice",
         lifetime: 60000,
         text: "{{ "File removed" | trans }}: "+ realName + "->" + (serverName == null ? "{{ "Not uploaded" | trans }}" : serverName) });
});

formData2 = [
    {
        type: "input",
        rows: 30,
        name: "crontab",
        inputWidth: 330,
        inputHeight: 460
    },
    {
        type: "button",
        name: "submit",
        value:"{{ "Convert" | trans }}"
    }
    ];
myForm2 = dhxTabbar.cells("a1").attachForm(formData2);
myForm2.setSkin("dhx_skyblue");

myForm.attachEvent("onUploadComplete", function(count) {
    // on charge le fichier cron dans le textearea
  //  myForm2.loadStruct("xml_Home_cron_form");
  myForm.send("{{ url('arii_Home_cron_form') }}", "GET", function (xml) {
        crontab = xml.xmlDoc.responseText;
        myForm2.setItemValue('crontab',crontab);
        dhxTabbar.setTabActive("a1");
  });
});

dhxLayout.cells("b").hideHeader();
var mygrid = dhxLayout.cells("b").attachGrid();
mygrid.setSkin("dhx_skyblue");
mygrid.setImagePath( "{{ asset('arii/images/') }}");
mygrid.setHeader("{{ "File" | trans }},{{ "Date" | trans }},{{ "Size" | trans }}");
mygrid.setColAlign("left,right,right");
mygrid.setInitWidths("*,140,100");
mygrid.setColTypes("ed,ro,ro");
mygrid.init();
mygrid.loadXML("{{ url('xml_Home_cron_dirlist') }}");

myForm2.attachEvent("onButtonClick", function(name, command){
    dhxLayout.cells("b").progressOn();      
    myForm2.send("{{ url('arii_Home_cron_convert') }}", "POST", function (xml) {
        n = xml.xmlDoc.responseText;
        if (n==0) {
            dhtmlx.message({
            type: "alert-error",
            lifetime: 60000,
            text: "{{ "No cron found !" | trans }}" });
            dhxLayout.cells("b").progressOff();
        }
        else
        mygrid.loadXML("{{ url('xml_Home_cron_dirlist') }}", function () {
            // file = mygrid.cells(1,0).getValue();
            // alert(file);
          //  dhxLayout.cells("c").attachURL("{{ url('xml_Home_cron_job_view') }}?file="+file);        
            dhxLayout.cells("b").progressOff();
        });
    });

});

dhxLayout.cells("c").hideHeader();
dhxLayout.cells("b").setHeight(200);
mygrid.attachEvent("onRowDblClicked",function(id, value){
    file = mygrid.cells(id,0).getValue();
    dhxLayout.cells("c").attachURL("{{ url('xml_Home_cron_job_view') }}?file="+file);        
});

function GlobalRefresh() {};

</script>
{% endblock %}
